<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <!-- CSS Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .user-header {
            background-color: #343a40;
            color: white;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logout-btn {
            color: white;
            background-color: #495057;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .logout-btn:hover {
            background-color: #6c757d;
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
        .nav-link {
            color: #495057;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
        }
        .nav-link.active {
            font-weight: bold;
            color: #0d6efd;
            background-color: transparent;
            border-bottom: 2px solid #0d6efd;
        }
        .action-buttons {
            white-space: nowrap;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .form-container {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .user-info-container {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .user-info-table {
            width: 100%;
            border-collapse: collapse;
        }
        .user-info-table th {
            text-align: left;
            padding: 12px;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        .user-info-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal-header {
            border-bottom: 1px solid #dee2e6;
        }
        .modal-footer {
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>

<body>
<!-- –®–∞–ø–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –∫–Ω–æ–ø–∫–æ–π –≤—ã—Ö–æ–¥–∞ -->
<div class="user-header">
    <span id="currentUserInfo"></span>
    <a th:href="@{/logout}" class="logout-btn">Logout</a>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- –õ–µ–≤–æ–µ –º–µ–Ω—é -->
        <div class="col-md-3 col-lg-2">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" id="adminTab" href="#">Admin</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="userTab" href="#">User</a>
                </li>
            </ul>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="col-md-9 col-lg-10">
            <h2 class="mb-4" id="mainTitle">Admin panel</h2>
            <!-- –¢–∞–±—ã –¥–ª—è Users table –∏ New User -->
            <ul class="nav nav-tabs" id="adminSubTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="usersTableTab" href="#">Users table</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="newUserTab" href="#">New User</a>
                </li>
            </ul>



            <!-- –°–µ–∫—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞  -->
            <div id="usersTableSection" class="content-section active">
                <h5 class="mb-3">All users</h5>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Last Name</th>
                        <th>Age</th>
                        <th>Role</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    <!-- JS –≤—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–æ–∫–∏ —Å—é–¥–∞ -->
                    </tbody>
                </table>
            </div>





            <!-- –°–µ–∫—Ü–∏—è —Å —Ñ–æ—Ä–º–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ -->
            <div id="newUserSection" class="content-section form-container">
                <h5 class="mb-3">Add new user</h5>

                <form id="newUserForm">
                    <div class="form-group">
                        <label for="username">First name</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last name</label>
                        <input type="text" class="form-control" id="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" class="form-control" id="age" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <div id="roleCheckboxes">
                            <!-- –†–æ–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                    <div class="form-group mt-4">
                        <button type="submit" class="btn btn-primary">Create</button>
                        <button type="button" id="cancelNewUser" class="btn btn-secondary ml-2">Cancel</button>
                    </div>
                </form>
            </div>



            <!-- –°–µ–∫—Ü–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
            <div id="userInfoSection" class="content-section user-info-container">
                <h5 class="mb-3">About user</h5>

                <table class="user-info-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Age</th>
                        <th>Role</th>
                    </tr>
                    </thead>
                    <tbody id="userInfoTableBody">
                    <!-- JS –≤—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–æ–∫—É —Å—é–¥–∞ -->
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">Edit user</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editUserForm">
                <div class="modal-body">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editUsername">First name</label>
                        <input type="text" class="form-control" id="editUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="editLastName">Last name</label>
                        <input type="text" class="form-control" id="editLastName" required>
                    </div>
                    <div class="form-group">
                        <label for="editAge">Age</label>
                        <input type="number" class="form-control" id="editAge" required>
                    </div>
                    <div class="form-group">
                        <label for="editPassword">Password</label>
                        <input type="password" class="form-control" id="editPassword" placeholder="Leave blank to keep current">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <div id="editRoleCheckboxes">
                            <!-- —Ä–æ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Edit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteUserModalLabel">Confirm deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body" id="deleteUserModalBody">
                <!-- –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div id="deleteUserContent">
                    <p><strong>Are you sure you want to delete this user?</strong></p>
                    <p class="text-danger">This action cannot be undone.</p>
                    <hr>
                    <ul class="list-unstyled" id="deleteUserDetails">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ —á–µ—Ä–µ–∑ JS -->
                    </ul>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn">Delete</button>
            </div>
        </div>
    </div>
</div>


<!-- JS Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // –ì–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Admin –∏ User
    document.getElementById('adminTab').addEventListener('click', function(e) {
        e.preventDefault();
        this.classList.add('active');
        document.getElementById('userTab').classList.remove('active');

        // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        document.getElementById('mainTitle').textContent = 'Admin panel';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–∞–±—ã –∏ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        document.getElementById('adminSubTabs').style.display = 'flex';
        showUsersTable();
    });

    document.getElementById('userTab').addEventListener('click', function(e) {
        e.preventDefault();
        this.classList.add('active');
        document.getElementById('adminTab').classList.remove('active');

        // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ "User information-page"
        document.getElementById('mainTitle').textContent = 'User information-page';

        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Ç–∞–±—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        document.getElementById('adminSubTabs').style.display = 'none';
        hideAllSections();
        document.getElementById('userInfoSection').classList.add('active');

        loadCurrentUserInfo(); // üëà –î–æ–±–∞–≤—å —Å—é–¥–∞ –≤—ã–∑–æ–≤
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ —Ñ–æ—Ä–º–æ–π –≤ —Ä–µ–∂–∏–º–µ Admin
    document.getElementById('usersTableTab').addEventListener('click', function(e) {
        e.preventDefault();
        showUsersTable();
    });

    document.getElementById('newUserTab').addEventListener('click', function(e) {
        e.preventDefault();
        hideAllSections();
        document.getElementById('newUserSection').classList.add('active');
        this.classList.add('active');
        document.getElementById('usersTableTab').classList.remove('active');
    });

    // –ö–Ω–æ–ø–∫–∞ Cancel –≤ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.getElementById('cancelNewUser').addEventListener('click', function(e) {
        e.preventDefault();
        showUsersTable();
    });

    function showUsersTable() {
        hideAllSections();
        document.getElementById('usersTableSection').classList.add('active');
        document.getElementById('usersTableTab').classList.add('active');
        document.getElementById('newUserTab').classList.remove('active');
    }

    function hideAllSections() {
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    function loadUserData(userId) {
        fetch('/admin/edit?id=' + userId)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.text();
            })
            .then(html => {
                document.getElementById('editUserModalBody').innerHTML = html;
            })
            .catch(error => {
                console.error('Error loading user data:', error);
                alert('Error loading user data. Please try again.');
            });
    }


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º Admin –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.getElementById('adminTab').click();



    fetch('/api/users/current')
        .then(response => response.json())
        .then(user => {
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ä–æ–ª—è–º–∏ (—É–¥–∞–ª—è–µ–º "ROLE_" –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
            const roles = user.roles.map(role => role.name.replace("ROLE_", "")).join(", ");

            // –°–æ–±–∏—Ä–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            const userInfo = `${user.username} with roles: ${roles}`;

            // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç
            document.getElementById('currentUserInfo').textContent = userInfo;
        })
        .catch(error => {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
        });



</script>











<script>// —Å–µ–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.addEventListener("DOMContentLoaded", () => {
        fetchUsersAndRenderTable();
    });
//—Ç—É—Ç –º—ã 390
    function fetchUsersAndRenderTable() {
        fetch("/api/users")
            .then(response => {
                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π");
                }
                return response.json();
            })
            .then(users => {
                const tbody = document.getElementById("usersTableBody");
                tbody.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                users.forEach(user => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.lastName}</td>
                    <td>${user.age}</td>
                    <td>${user.roles.map(role => role.name.replace("ROLE_", "")).join(", ")}</td>

                    <td class="action-buttons">
                        <button class="btn btn-outline-warning btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#editUserModal"
                                onclick="loadUserData(${user.id})">
                            Edit
                        </button>
                    </td>

                    <td class="action-buttons">
                        <button class="btn btn-outline-danger btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteUserModal"
                                onclick="loadUserForDelete(${user.id})">
                            Delete
                        </button>
                    </td>
                `;
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
            });
    }
</script>



<script> // —Å–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.addEventListener("DOMContentLoaded", () => {
        fetchRolesForForm();

        const form = document.getElementById("newUserForm");
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.getElementById("username").value;
            const lastName = document.getElementById("lastName").value;
            const age = parseInt(document.getElementById("age").value, 10);
            const password = document.getElementById("password").value;

            const selectedRoleIds = Array.from(document.querySelectorAll("#roleCheckboxes input:checked"))
                .map(cb => parseInt(cb.value, 10));

            const newUser = {
                username,
                lastName,
                age,
                password,
                roles: selectedRoleIds.map(id => ({ id }))  // –≤–∞–∂–Ω–æ: id —Ä–æ–ª–∏
            };

            try {
                const response = await fetch("/api/users", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(newUser)
                });

                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
                }

                // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                form.reset();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                fetchUsersAndRenderTable();

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞:", error);
            }
        });

        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        document.getElementById("cancelNewUser").addEventListener("click", () => {
            form.reset();
        });
    });

    function fetchRolesForForm() {
        fetch("/api/roles")
            .then(response => {
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–æ–ª–µ–π");
                return response.json();
            })
            .then(roles => {
                const container = document.getElementById("roleCheckboxes");
                container.innerHTML = "";
                roles.forEach(role => {
                    const div = document.createElement("div");
                    div.classList.add("form-check");
                    div.innerHTML = `
                    <input class="form-check-input" type="checkbox" id="role_${role.id}" value="${role.id}">
                    <label class="form-check-label" for="role_${role.id}">
                        ${role.name.replace("ROLE_", "")}
                    </label>
                `;
                    container.appendChild(div);
                });
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–æ–ª–µ–π:", error);
            });
    }
</script>




<script> // —Å–µ–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let currentUserIdToEdit = null;

    function loadUserData(userId) {
        currentUserIdToEdit = userId;

        fetch(`/api/users/${userId}`)
            .then(response => response.json())
            .then(user => {
                document.getElementById("editUserId").value = user.id;
                document.getElementById("editUsername").value = user.username;
                document.getElementById("editLastName").value = user.lastName;
                document.getElementById("editAge").value = user.age;
                document.getElementById("editPassword").value = ""; // –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ä–æ–ª–∏
                fetch("/api/roles")
                    .then(response => response.json())
                    .then(roles => {
                        const container = document.getElementById("editRoleCheckboxes");
                        container.innerHTML = "";

                        roles.forEach(role => {
                            const checked = user.roles.some(r => r.id === role.id) ? "checked" : "";
                            const div = document.createElement("div");
                            div.classList.add("form-check");
                            div.innerHTML = `
                            <input class="form-check-input" type="checkbox" id="edit_role_${role.id}" value="${role.id}" ${checked}>
                            <label class="form-check-label" for="edit_role_${role.id}">${role.name.replace("ROLE_", "")}</label>
                        `;
                            container.appendChild(div);
                        });
                    });
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
            });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–±–º–∏—Ç–∞ —Ñ–æ—Ä–º—ã
    document.getElementById("editUserForm").addEventListener("submit", function(e) {
        e.preventDefault();

        const id = document.getElementById("editUserId").value;
        const username = document.getElementById("editUsername").value;
        const lastName = document.getElementById("editLastName").value;
        const age = parseInt(document.getElementById("editAge").value);
        const password = document.getElementById("editPassword").value;

        const selectedRoles = Array.from(document.querySelectorAll("#editRoleCheckboxes input:checked"))
            .map(cb => ({ id: parseInt(cb.value) }));

        const updatedUser = {
            id,
            username,
            lastName,
            age,
            password,
            roles: selectedRoles
        };

        fetch(`/api/users/${id}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(updatedUser)
        })
            .then(response => {
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
                return response.json();
            })
            .then(() => {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
                const modal = bootstrap.Modal.getInstance(document.getElementById('editUserModal'));
                modal.hide();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                fetchUsersAndRenderTable();
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:", error);
            });
    });
</script>



<script> // —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let currentUserIdToDelete = null;

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∏ –ø–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    function loadUserForDelete(userId) {
        currentUserIdToDelete = userId;

        fetch(`/api/users/${userId}`)
            .then(response => {
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
                return response.json();
            })
            .then(user => {
                const roles = user.roles.map(r => r.name.replace("ROLE_", "")).join(", ");
                const html = `
                <p><strong>Are you sure you want to delete this user?</strong></p>
                <p class="text-danger">This action cannot be undone.</p>
                <hr>
                <ul class="list-unstyled">
                    <li><strong>ID:</strong> ${user.id}</li>
                    <li><strong>Username:</strong> ${user.username}</li>
                    <li><strong>Last name:</strong> ${user.lastName}</li>
                    <li><strong>Age:</strong> ${user.age}</li>
                    <li><strong>Roles:</strong> ${roles}</li>
                </ul>
            `;
                document.getElementById("deleteUserModalBody").innerHTML = html;
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:", error);
                document.getElementById("deleteUserModalBody").innerHTML = `
                <div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
            `;
            });
    }

</script>



<script>
    function loadCurrentUserInfo() {
        fetch("/api/users/current")
            .then(response => {
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
                return response.json();
            })
            .then(user => {
                const tbody = document.getElementById("userInfoTableBody");
                tbody.innerHTML = `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.lastName}</td>
                    <td>${user.age}</td>
                    <td>${user.roles.map(r => r.name.replace("ROLE_", "")).join(", ")}</td>
                </tr>
            `;
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞:", error);
            });
    }
</script>





<script>
    document.getElementById("confirmDeleteUserBtn").addEventListener("click", function () {
        if (!currentUserIdToDelete) return;

        fetch(`/api/users/${currentUserIdToDelete}`, {
            method: "DELETE"
        })
            .then(response => {
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                fetchUsersAndRenderTable();

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modalEl = document.getElementById("deleteUserModal");
                const modal = bootstrap.Modal.getInstance(modalEl);
                if (modal) modal.hide();
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
            });
    });
</script>
</body>
</html>